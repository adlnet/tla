<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <!--Basic Properties-->
    <meta name="ID" content="A GUID that uniquely describes the activity." />
    <meta name="Name" content="The human- readable name of the activity. Will usually match title" />
    <meta name="Description" content="A human- readable description of the activity." />
    <meta name="Language" content="The primary language used in the activity." />
    <meta name="Subject" content="The primary topic covered by the activity." />
    <meta name="Authors" content="Person or organization that created the activity." />
    <meta name="Contributors" content="Person or organization that supported the author , e.g. (e.g.e.g., artists, reviewers)." />
    <meta name="Publishers" content="The person or organization that produced and distributed the activity." />
    <meta name="Providers" content="The software application or service that hosts the activity." />
    <meta name="Licenses" content="The legal constraints that govern distribution and use of the activity." />
    <meta name="Versions" content="A number representing the release version of the activity. Each should be related to a release date." />
    <meta name="ReleaseDates" content="The date when the activity was created or updated. Each date should be related to a specific version." />
    <meta name="Size" content="A number representing the file size of the activity." />
    <meta name="CompletionStatus" content="A description of the current lifecycle state of the activity (e.g.e.g., draft, alpha, beta, final)." />
    <meta name="Icon" content="An image that represents the activity graphically." />
    <meta name="Preview" content="A video snippet that represents the activity." />
    <meta name="Keywords" content="Search engine- compatible words that describe the activity." />
    <meta name="FullText" content="The full text of the activity (if applicable)." />
    <meta name="UserGuide" content="User manual describing activity usage and installation." />
    <meta name="Citations" content="Relevant bibliographic citations." />
    <!--Interoperability Properties-->
    <meta name="LaunchURI" content="The web URI used to launch the activity (if applicable)." />
    <meta name="Protocols" content="The transport protocols the activity is compatible with (e.g.e.g., REST, Pub/Sub, Security, Compression, etc.)." />
    <meta name="AuthorizationLevels" content="The permissions of the activity that govern what data it can read/write/access" />
    <meta name="ContentURIs" content="The locations of content resources the activity uses but does not host." />
    <meta name="MetadataURIs" content="The locations of content resources the activity uses but does not host." />
    <meta name="Platforms" content="The operating system types and versions that are required or compatible with the activity." />
    <meta name="Devices" content="The devices (e.g.e.g., mobile device, laptop) that are required or compatible with the activity." />
    <meta name="InputModalitys" content="The input devices that are required or compatible with the activity (e.g.e.g., mouse)" />
    <meta name="Browsers" content="The web browsers that are required or compatible with the activity." />
    <meta name="Sensors" content="The sensor devices that are required or compatible with the activity (e.g., eye tracking)." />
    <meta name="OtherRequirements" content="Strings or GUIDs that describe other TLA components or functional roles required for correct behavior (e.g.e.g., requires an LRS)." />
    <meta name="MetadataAuthors" content="The creators of Activity metadata. May be a person or a software component." />
    <meta name="Locations" content="Locations that are required or compatible with performing this activity (e.g.e.g., home, simulation center, live exercise field etc.)." />
    <meta name="AccessibilityFeatures" content="Alternate content of the activity that support accessibility." />
    <meta name="AccessibilityAPIs" content="The specific Accessibility APIs this activity is compatible with." />
    <meta name="AccessibilityDevices" content="The accessibility input and output modalities compatible the activity is compatible with." />
    <meta name="AccessibilityHazards" content="Characteristics of the activity that could be physiologically dangerous to some learners." />
    <meta name="DebugFlags" content="Flags that can be used for debug and development purposes (e.g.e.g., testing, placeholder)." />
    <!--Learning Experience Properties-->
    <meta name="TargetUser" content="The intended activity user (e.g.e.g., learner, teacher etc.)." />
    <meta name="ExpectedCompletionTime" content="Expected average time needed for completion of the activity. May be a range." />
    <meta name="MinimumCompletionTime" content="Minimum suggested time for completion of the activity." />
    <meta name="MaximumCompletionTime" content="Maximum allowed time for completion of the activity." />
    <meta name="EnforceCompletionTime" content="Boolean indicating if the maximum completion time should be enforced." />
    <meta name="EducationalContext" content="The level of education the activity was designed for (e.g.e.g., middle school, high school, university, training)." />
    <meta name="InstructionalScopes" content="The functional granularity (e.g.e.g., course, unit, lesson) that the activity represents." />
    <meta name="LearningResourceTypes" content="The types of content presented by the activity (e.g.,e.g., text, simulation, video, audio, augmented reality). It should be descriptive of the medium used by the activity, rather than the educational purpose for which the activity is intended." />
    <meta name="InstructionalStrategys" content="The instructional design strategy or model that was used to design this activity. (e.g. Bloom, Gagne, Merrrill). Caveat: This field is deliberately open ended so that both accepted, and newly emerging strategies and models can be used with the TLA." />
    <meta name="InstructionalTypes" content="The types of instructional use that the activity was designed for (e.g., practice, assessment). It should be descriptive of the educational purpose the activity is intended for rather than the type of content presented by the activity." />
    <meta name="SupportLevel" content="The amount of support the activity provides (e.g., high/low)." />
    <meta name="SupportMechanisms" content="The types of support the activity employs (e.g., scaffolding, tutoring, feedback)." />
    <meta name="LearnerControlTypes" content="The type of control the learner is allowed in the activity (e.g.e.g., self-paced vs. timed)." />
    <meta name="ReplayabilityLevel" content="How suitable the activity is for repetition." />
    <meta name="MinimumReplayWaitingPeriod" content="The minimum amount of time that should elapse between repetitions." />
    <meta name="FormFitFunctionFidelity" content="The fidelity level of the activity as it applies to what is being taught (e.g., high/med/low)." />
    <!--Competency Relationships-->
    <meta name="EducationalFrameworks" content="The educational framework(s) that this activity is aligned to." />
    <meta name="CompetencyLevel" content="The expected level (e.g., novice/intermediate/advanced) in one or more specific competencies that this activity's Instructional Type is targeting." />
    <meta name="ChallengeLevel" content="The amount of challenge per competency that the activity presents to the learner." />
    <meta name="Interactivity Level" content="The level of interactivity (e.g., Passive, Limited Participation, Complex Participation, Real-time Participation) per competency that the activity presents to the learner." />
    <meta name="ExpectedMastery" content="The expected level of mastery per Competency that the learner is expected to have upon completion of the activity with an affiliated confidence value." />
    <meta name="Credentials" content="Specific types of credentials per Competency that are expected to be awarded to the learner upon completion of the activity. Could be formal (e.g., degree or certification) or informal (e.g., badges)." />
    <meta name="Rewards" content="Specific types of incentive that are expected to be awarded to the learner per competency during the activity (e.g., points, coins, tokens)." />
    <meta name="ScoreTypes" content="The type of measurements this Activity produces per competency if it performs assessment or scoring (e.g., percentage vs. pass/fail)." />
    <!--Activity Relationships-->
    <meta name="ActivityRelations" content="Expresses the relationship of this activity to another specific activity (e.g., prerequisite activities, assessments that are appropriate for specific teaching activities, reference materials that relate to the activity). There may be many relationships." />
    <!--Learner Relationships-->
    <meta name="LearnerCulture" content="The expected cultural bias of the learner that the activity is designed for." />
    <meta name="LearnerLanguage" content="The expected primary language of the learner the activity is designed for." />
    <meta name="LearnerAge" content="The expected age range of the learner that the activity is designed for." />
    <meta name="LearnerHeight" content="The expected height range of the learner that the activity is designed for." />
    <meta name="LearnerWeight" content="The expected weight range of the learner that the activity is designed for." />
    <meta name="LearnerFitnessLevel" content="The expected fitness range of the learner that the activity is designed for." />
    <meta name="LearnerMaximumExertionLevel" content="The maximum level of exertion that the activity will require." />
    <meta name="LearnerAccessibility" content="The accessibility situations the activity is designed to accommodate (sight/hearing/hands/full body)." />
    <meta name="LearnerIntrinsicMotivationLevel" content="The expected intrinsic motivation range of the learner that the activity is designed for." />
    <meta name="LearnerIntelligenceLevels" content="The range of intelligence levels (e.g., IQ) that the activity is designed for." />
    <meta name="LearnerReadingLevels" content="The range of reading levels (e.g., K�12) the activity is designed for." />
    <meta name="LearnerPreferences" content="This property provides an open-ended location to indicate one or more learner preferences that this activity was designed for (e.g., audio vs. text)." />
    <meta name="LearnerInterests" content="This property provides an open-ended location to indicate one or more learner interests that this activity was designed for (e.g., hobbies)." />
    <meta name="LearnerJobs" content="The expected learner job function, role or MOS that this activity was designed for." />
    <meta name="LearnerCredentials" content="The expected learner credentials (e.g., degree or certifications) that are prerequisites for this activity." />
    <meta name="LearnerRanks" content="The expected learner military rank that this activity was designed for." />
    <title>Basic PDF Demo</title>
    
</head>

<body class="text-center">

    <link href="/templates/pdf-viewer/public/css/pdf-header.css" rel="stylesheet">

    <nav id="navbar" class="navbar navbar-default fixed-top navbar-dark bg-dark form-inline">
        <span >
            <button id="prev" class="btn btn-secondary ">
                Previous Page
            </button>
        </span>
        
        <b>Demo PDF Viewer</b>

        <span class="nav-link "> Page: <input class="form-control number" style="width: 80px;" id="page_num"> / <span id="page_count" style="width: 15vw">1</span></span>
        
        <span class="slidecontainer">
            <span id="scale_text">Zoom: 100%</span>
            <input id="scale_slider" type="range" min="50" max="200" value="100" class="slider" id="myRange">
        </span>
        
        <span class="">
            <button id="next" class="btn btn-secondary ">
                Next Page
            </button>
        </span>
    </nav>
    <div id="pdf_container" style="margin-top: 60px">
        <!--The actual canvas for the pdf file-->
        <canvas id="the-canvas" style="width: 60vw; margin:auto; display:block"></canvas>
    </div>

    <!-- Bootstrap core CSS -->
    <link href="/templates/pdf-viewer/public/css/bootstrap.min.css" rel="stylesheet">
    <link href="/templates/pdf-viewer/public/css/navbar-static-top.css" rel="stylesheet">
    <link href="/templates/pdf-viewer/public/css/cover-modified.css" rel="stylesheet">
    
    <link href="/templates/pdf-viewer/public/js/jquery.min.js" rel="stylesheet">
    <link href="/templates/pdf-viewer/public/js/bootstrap.min.js" rel="stylesheet">

    <script src="/templates/pdf-viewer/build/pdf.js"></script>
    <script type="text/javascript" src="/templates/pdf-viewer/build/xapiwrapper.min.js"></script>
    <script type="text/javascript" src="/templates/pdf-viewer/build/verbs.js"></script>

    <script type="text/javascript">
        //sets up starting info
        var startPage = 1;
        var pdfDefault = '/templates/pdf-viewer/adl-nato-handbook.pdf'
        var completeSent = false;

        //sets up activty info
        var vidURI = 'demo:static';
        var vidName = 'Demo StaticPage';
        var vidDes = 'A website that exercises the functions of the xAPIWrapper for converting static flash content';

        //sets up user info
        var email = 'mailto:florian.tolk.ctr@adlnet.gov';
        var username = 'Florian Tolk'

        //sets up the LRS Credentials
        var wrapper = ADL.XAPIWrapper;

        wrapper.changeConfig({
            // Your LRS's xAPI endpoint.  This isn't guaranteed to be something 
            // ending in /xAPI, but that is the most popular convention.
            "endpoint": "https://lrs.adlnet.gov/xAPI/",

            // Basic Auth string, form of Base64("username:password")
            "auth": "Basic " + toBase64("ADLTechTeam:xapiIsCool!")
        });

        //creates new statement
        var stmt;

        function initSTMT() {
            //creates statement
            stmt = new ADL.XAPIStatement(
                new ADL.XAPIStatement.Agent(wrapper.hash(email), username),
                verbs.interacted,
                new ADL.XAPIStatement.Activity(vidURI, vidName, )
            );
            //sets up extensions
            wrapper.baseURI = "https://w3id.org/xapi/static/extensions/";
            stmt.result = {
                extensions: {}
            };
            stmt.context = {
                extensions: {}
            };
        };

        //When page is loaded
        initSTMT();
        stmt.verb = verbs.initialized;
        var resp_obj = wrapper.sendStatement(stmt);

        //On abort
        function abortFile() {
            initSTMT();
            stmt.verb = verbs.aborted;
            var resp_obj = wrapper.sendStatement(stmt);
        };

        function pageTransport(newPage) {
            if (newPage == pageNumber)
            pageNumber = newPage;

        }

        //When teh user goes to the next page
        function pagedNext(newPage, _prev) {
            initSTMT();
            stmt.verb = verbs.pagedNext;
            stmt.context.extensions[wrapper.baseURI + "prevPage"] = (_prev == null) ? newPage - 1 : _prev;
            stmt.context.extensions[wrapper.baseURI + "newPage"] = newPage;
            stmt.context.extensions[wrapper.baseURI + "pageCount"] = pdfDoc.numPages;
            var resp_obj = wrapper.sendStatement(stmt);
        };

        //When teh user goes back a page
        function pagedPrevious(newPage, _prev) {
            initSTMT();
            stmt.verb = verbs.pagedPrevious;
            stmt.context.extensions[wrapper.baseURI + "prevPage"] = (_prev == null) ? newPage + 1 : _prev;
            stmt.context.extensions[wrapper.baseURI + "newPage"] = newPage;
            stmt.context.extensions[wrapper.baseURI + "pageCount"] = pdfDoc.numPages;
            var resp_obj = wrapper.sendStatement(stmt);
        }

        // When the user jumps to a different page
        function pagedJump(newPage, _prev) {
            initSTMT();
            stmt.verb = verbs.pagedJump;
            stmt.context.extensions[wrapper.baseURI + "prevPage"] = (_prev == null) ? newPage : _prev;
            stmt.context.extensions[wrapper.baseURI + "newPage"] = newPage;
            stmt.context.extensions[wrapper.baseURI + "pageCount"] = pdfDoc.numPages;
            var resp_obj = wrapper.sendStatement(stmt);
        };

        //When the user reaches the last page
        function completed(newPage) {
            initSTMT();
            stmt.verb = verbs.completed;
            stmt.context.extensions[wrapper.baseURI + "pageCount"] = pdfDoc.numPages;
            var resp_obj = wrapper.sendStatement(stmt);
        }
    </script>

    <script id="script">

        // Determine where to load our first PDF from
        const urlParams = new URLSearchParams(window.location.search);
        var url = urlParams.get('url');

        if (url == undefined)
            url = pdfDefault

        //
        // In cases when the pdf.worker.js is located at the different folder than the
        // PDF.js's one, or the PDF.js is executed via eval(), the workerSrc property
        // shall be specified.
        //
        pdfjsLib.GlobalWorkerOptions.workerSrc = '/templates/pdf-viewer/build/pdf.worker.js';
        var pdfDoc = url,
            pageNum = startPage,
            pageRendering = true,
            pageNumPending = null,
            scale = 10,
            canvas = document.getElementById('the-canvas'),
            ctx = canvas.getContext('2d');
        /**
         * Get page info from document, resize canvas accordingly, and render page.
         * @param num Page number.
         */
        function renderPage(num) {
            pageRendering = true;
            // Using promise to fetch the page
            pdfDoc.getPage(num).then(function (page) {
                var viewport = page.getViewport({
                    scale: scale,
                });
                canvas.height = viewport.height;
                canvas.width = viewport.width;
                // Render PDF page into canvas context
                var renderContext = {
                    canvasContext: ctx,
                    viewport: viewport,
                };
                var renderTask = page.render(renderContext);
                // Wait for rendering to finish
                renderTask.promise.then(function () {
                    pageRendering = false;
                    if (pageNumPending !== null) {
                        // New page rendering is pending
                        renderPage(pageNumPending);
                        pageNumPending = null;
                    }
                });
            });
            // Update page counters
            document.getElementById('page_num').value = num;
        }
        /**
         * If another page rendering in progress, waits until the rendering is
         * finised. Otherwise, executes rendering immediately.
         */
        function queueRenderPage(num) {
            if (pageRendering) {
                pageNumPending = num;
            } else {
                renderPage(num);
            }
        }
        /**
         * Displays previous page.
         */
        function onPrevPage() {
            if (pageNum <= 1) {
                return;
            }
            pageNum--;
            pagedPrevious(pageNum);
            queueRenderPage(pageNum);
            document.documentElement.scrollTop = 0;
        }
        document.getElementById('prev').addEventListener('click', onPrevPage);
        /**
         * Displays next page.
         */
        function onNextPage() {
            if (pageNum >= pdfDoc.numPages) {
                return;
            }
            pageNum++;
            pagedNext(pageNum);
            if (pageNum >= pdfDoc.numPages && completeSent == false) {
                completed(pageNum);
                completeSent = true;
            }
            queueRenderPage(pageNum);
            document.documentElement.scrollTop = 0;
        }
        document.getElementById('next').addEventListener('click', onNextPage);

        /**
         * Asynchronously downloads PDF.
         */
        function setDocument(url_) {
            pdfjsLib.getDocument(url_).promise.then(function (pdfDoc_) {
                pdfDoc = pdfDoc_;
                document.getElementById('page_count').textContent = pdfDoc.numPages;
                // Initial/first page rendering
                renderPage(pageNum);
            });
        }

        // Load the document
        setDocument(url);
    </script>

    <script>
        // Recycle the functions above to do this
        function pageTransport(num) {

            if (num != pageNum) {
                pagedJump(num, pageNum);
            } else { 
                return;
            }
            pageNum = num;
            queueRenderPage(num);
        }

        // Call this if we had an Enter keypress from the page input
        document.getElementById('page_num').addEventListener('keyup', function(ev){
            if (ev.keyCode == 13) {
                var p = document.getElementById("page_num").value;
                p = (p < 1) ? 1 : (p > pdfDoc.numPages) ? pdfDoc.numPages : p;
                
                // Update our control and navigate
                document.getElementById('page_num').value = p;
                pageTransport(Number(p));
            }
        });

        // Implement the scale slider
        var scaleText = document.getElementById("scale_text");
        var scaleSlider = document.getElementById("scale_slider");
        var defaultWidth = canvas.style.width;
        
        if (defaultWidth.endsWith("vw")) {
            defaultWidth = Number(defaultWidth.substr(0, defaultWidth.length - 2))
        }

        scaleSlider.oninput = function() {
            scaleText.textContent = `Zoom: ${scaleSlider.value}%`;
            canvas.style.width = `${defaultWidth * scaleSlider.value / 100}vw`;
        }

    </script>

</body>

</html>